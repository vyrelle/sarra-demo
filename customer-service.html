<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SARRA</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .sidebar-transition {
      transition: transform 0.3s ease-in-out;
    }
    .chat-message {
      animation: fadeIn 0.3s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .loader {
      border: 2px solid #f3f3f3;
      border-top: 2px solid #4b5563; 
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .case-tag {
      animation: slideIn 0.3s ease-out;
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .suggestion-btn {
      transition: all 0.2s ease;
      border: 1px solid transparent;
    }
    .suggestion-btn:hover {
      border-color: #e5e7eb;
      background-color: #f9fafb;
    }
    .input-container {
      position: relative;
      background: white;
      border: 1px solid #d1d5db;
      border-radius: 1rem;
      padding: 0.625rem 1rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    .input-container:focus-within {
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    .case-tag-inside {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      background: #eff6ff;
      color: #1e40af;
      padding: 0.25rem 0.5rem;
      border-radius: 0.375rem;
      font-size: 0.75rem;
      font-weight: 500;
      border: 1px solid #bfdbfe;
    }
    .send-btn-subtle {
      background: #9ca3af;
      transition: background 0.2s;
    }
    .send-btn-subtle:hover {
      background: #6b7280;
    }
    .star {
      cursor: pointer;
      transition: color 0.2s ease;
    }
    .star:hover {
      color: #f7bc0d;
    }
    .star.active {
      color: #f7bc0d;
    }
    .rate-button {
      background-color: rgba(75, 85, 99, 0.1); 
      color: #374151; 
      font-size: 0.875rem;
    }
    .rate-button:hover {
      background-color: rgba(75, 85, 99, 0.2);
    }
    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 50;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 40;
    }
  </style>
</head>
<body class="bg-white font-sans">

  <div id="sidebar" class="fixed left-0 top-0 h-full w-80 bg-gray-900 text-white z-50 sidebar-transition transform -translate-x-full border-r border-gray-700">
    <div class="flex flex-col h-full">
      <div class="flex items-center justify-between p-4 border-b border-gray-700">
        <a href="index.html" class="text-xl font-bold tracking-widest text-white">SARRA</a>
        <button id="closeSidebar" class="p-2 hover:bg-gray-800 rounded">
          <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <div class="p-4">
        <button id="newChatBtn" class="w-full flex items-center gap-3 p-3 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors text-white">
          <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
          </svg>
          <span>New Chat</span>
        </button>
      </div>
      
      <div class="flex-1"></div>
      
      <div class="p-4 border-t border-gray-700">
        <div class="flex items-center gap-3">
          <div class="w-8 h-8 bg-indigo-600 rounded-full flex items-center justify-center">
            <span class="text-sm font-medium text-white">G</span>
          </div>
          <div class="flex-1 min-w-0">
            <span class="text-sm text-gray-300">Guest</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="mainContent" class="min-h-screen flex flex-col transition-all duration-300 ml-0">
    <header class="bg-white border-b border-gray-200 p-4 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <button id="openSidebar" class="p-2 hover:bg-blue-100 rounded">
          <svg class="w-6 h-6 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
        <h2 class="text-xl font-bold tracking-widest text-gray-700">SARRA Assistant</h2>
      </div>
      
      <div class="flex items-center gap-2">
        <button onclick="window.location.href='index.html'" class="text-sm text-gray-600 hover:text-gray-800 transition-colors">
          ← Back
        </button>
      </div>
    </header>
    
    <div class="flex-1 flex flex-col max-w-4xl mx-auto w-full">
      <div id="welcomeScreen" class="flex-1 flex flex-col justify-center items-center p-8">
        <div class="w-full max-w-2xl" style="transform: translateY(-40px);">
          
          <div class="input-container mb-4">
            <textarea 
              id="messageInput" 
              placeholder="Ask a question..." 
              class="w-full focus:outline-none resize-none bg-transparent text-gray-800 mb-2"
              rows="1"
              style="min-height: 24px;"
            ></textarea>

            <div class="flex justify-between items-center">
              <div id="caseTagInside" class="case-tag case-tag-inside">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z"></path>
                </svg>
                <span>Customer Service</span>
                <button onclick="window.location.href='chat.html'" class="ml-1 hover:bg-blue-200 rounded-full p-0.5 transition-colors">
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                  </svg>
                </button>
              </div>
              
              <button id="sendButton" 
                class="send-btn-subtle flex items-center justify-center w-8 h-8 text-white rounded-full transition-colors text-sm">
                ➤
              </button>
            </div>
          </div>

          <div class="grid gap-1">
            <button class="suggestion-btn text-left px-4 py-3 rounded-lg text-sm text-gray-700 transition-all" onclick="fillQuestion(this.textContent)">
              How can I track my order on Amazon?
            </button>
            <button class="suggestion-btn text-left px-4 py-3 rounded-lg text-sm text-gray-700 transition-all" onclick="fillQuestion(this.textContent)">
              What should I do if my package hasn't arrived yet?
            </button>
            <button class="suggestion-btn text-left px-4 py-3 rounded-lg text-sm text-gray-700 transition-all" onclick="fillQuestion(this.textContent)">
              How can I return a product I bought online?
            </button>
            <button class="suggestion-btn text-left px-4 py-3 rounded-lg text-sm text-gray-700 transition-all" onclick="fillQuestion(this.textContent)">
              Who can I contact for a billing issue with my subscription?
            </button>
          </div>
        </div>
      </div>

      <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-4 hidden max-w-2xl mx-auto w-full"></div>
      
      <div id="questionBlock" class="p-4 bg-white pb-8 hidden">
        <div class="max-w-2xl mx-auto w-full">
          <div class="input-container">
            <textarea 
              id="chatInput" 
              placeholder="Ask a question..." 
              class="w-full focus:outline-none resize-none bg-transparent text-gray-800 mb-2"
              rows="1"
              style="min-height: 24px;"
            ></textarea>

            <div class="flex justify-between items-center">
              <div id="caseTagChat" class="case-tag case-tag-inside">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z"></path>
                </svg>
                <span>Customer Service</span>
                <button onclick="window.location.href='chat.html'" class="ml-1 hover:bg-blue-200 rounded-full p-0.5 transition-colors">
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                  </svg>
                </button>
              </div>
              
              <button id="chatSendButton" 
                class="send-btn-subtle flex items-center justify-center w-8 h-8 text-white rounded-full transition-colors text-sm disabled:bg-gray-400">
                ➤
              </button>
            </div>
          </div>
        </div>
      </div>

      <div id="ratingBlock" class="modal hidden p-6 bg-white rounded-lg shadow-lg">
        <div class="flex justify-between items-center mb-4">
          <h4 class="text-lg font-semibold text-gray-800">Rate the answer</h4>
          <button id="closeRatingModal" class="p-2 hover:bg-gray-200 rounded">
            <svg class="w-5 h-5 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">Rating:</label>
          <div class="flex gap-1" id="starRating">
            <span class="star text-2xl text-gray-300 cursor-pointer" data-rating="1">★</span>
            <span class="star text-2xl text-gray-300 cursor-pointer" data-rating="2">★</span>
            <span class="star text-2xl text-gray-300 cursor-pointer" data-rating="3">★</span>
            <span class="star text-2xl text-gray-300 cursor-pointer" data-rating="4">★</span>
            <span class="star text-2xl text-gray-300 cursor-pointer" data-rating="5">★</span>
          </div>
        </div>

        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">Your feedback</label>
          <textarea 
            id="commentInput" 
            class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-gray-600"
            rows="3"
          ></textarea>
        </div>

        <button id="submitFeedback" class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 transition-colors">
          Submit
        </button>
      </div>

      <div id="modalOverlay" class="modal-overlay hidden"></div>
    </div>
  </div>

  <script>
    let currentRating = 0;

    const sidebar = document.getElementById('sidebar');
    const openSidebarBtn = document.getElementById('openSidebar');
    const closeSidebarBtn = document.getElementById('closeSidebar');
    const messageInput = document.getElementById('messageInput');
    const chatInput = document.getElementById('chatInput');
    const sendButton = document.getElementById('sendButton');
    const chatSendButton = document.getElementById('chatSendButton');
    const welcomeScreen = document.getElementById('welcomeScreen');
    const chatMessages = document.getElementById('chatMessages');
    const questionBlock = document.getElementById('questionBlock');
    const newChatBtn = document.getElementById('newChatBtn');
    const ratingBlock = document.getElementById('ratingBlock');
    const modalOverlay = document.getElementById('modalOverlay');
    const closeRatingModal = document.getElementById('closeRatingModal');

    function openSidebar() {
      sidebar.classList.remove('-translate-x-full');
      document.getElementById('mainContent').style.marginLeft = '320px';
      document.getElementById('openSidebar').style.display = 'none';
    }

    function closeSidebar() {
      sidebar.classList.add('-translate-x-full');
      document.getElementById('mainContent').style.marginLeft = '0px';
      document.getElementById('openSidebar').style.display = 'block';
    }

    function fillQuestion(text) {
      messageInput.value = text.trim();
      messageInput.focus();
    }

    messageInput.addEventListener('keydown', function(e) {
      if(e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendButton.click();
      }
    });

    chatInput.addEventListener('keydown', function(e) {
      if(e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        chatSendButton.click();
      }
    });

    sendButton.addEventListener('click', sendMessage);

    chatSendButton.addEventListener('click', () => {
      const message = chatInput.value.trim();
      if (!message) return;
      addMessage('user', message);
      chatInput.value = '';
      
      showLoader();
      setTimeout(() => {
        hideLoader();
        const botResponse = getDemoResponse(message);
        addMessage('bot', botResponse);
        addRateButton();
      }, 1500);
    });

    function sendMessage() {
      const message = messageInput.value.trim();
      if (!message) return;

      welcomeScreen.classList.add('hidden');
      chatMessages.classList.remove('hidden');
      questionBlock.classList.remove('hidden');

      addMessage('user', message);
      const userQuestion = message;
      messageInput.value = '';

      showLoader();
      setTimeout(() => {
        hideLoader();
        const botResponse = getDemoResponse(userQuestion);
        addMessage('bot', botResponse);
        addRateButton();
      }, 1500);
    }

    function addMessage(sender, text) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `chat-message flex ${sender === 'user' ? 'justify-end' : 'justify-start'}`;
      const messageContent = document.createElement('div');
      messageContent.className = `max-w-full px-4 py-2 rounded-lg ${
        sender === 'user' ? 'bg-gray-600 text-white' : 'bg-white border border-gray-300 text-gray-800'
      }`;
      messageContent.textContent = text;
      messageDiv.appendChild(messageContent);
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function addRateButton() {
      const existingRateButton = document.querySelector('[id^="rateAnswerBtn"]');
      if (existingRateButton) {
        existingRateButton.remove();
      }

      const rateDiv = document.createElement('div');
      rateDiv.className = 'chat-message flex justify-start mt-2';
      const uniqueId = `rateAnswerBtn-${Date.now()}`; 
      rateDiv.innerHTML = `
        <button id="${uniqueId}" class="flex items-center gap-2 px-3 py-1 rate-button rounded-lg transition-colors">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.783-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
          </svg>
          <span>Rate the answer</span>
        </button>
      `;
      chatMessages.appendChild(rateDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;

      document.getElementById(uniqueId).addEventListener('click', showRatingBlock);
    }

    function showLoader() {
      const loaderDiv = document.createElement('div');
      loaderDiv.id = 'loader';
      loaderDiv.className = 'chat-message flex justify-start';
      loaderDiv.innerHTML = `
        <div class="max-w-full px-4 py-2 rounded-lg bg-white border border-gray-300 flex items-center gap-2">
          <div class="loader"></div>
          <span class="text-gray-700">Generating response...</span>
        </div>
      `;
      chatMessages.appendChild(loaderDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function hideLoader() {
      const loader = document.getElementById('loader');
      if (loader) loader.remove();
    }

    function getDemoResponse(question) {
      const responses = {
        'track': `You can easily track your Amazon order by logging into your account 
    and going to the "Your Orders" section. 

    Once there, find the specific order you want to track and click on "Track Package." 
    This will show you the current location of your package, the shipping status, 
    and the estimated delivery date. 

    If you notice any delays or issues, Amazon also provides options to contact 
    customer support directly or request updates via email or app notifications.`,
        
        'package': `If your package hasn't arrived yet, first check the estimated delivery date in your order confirmation email or tracking page. 

    If the delivery date has passed, contact the courier service using the tracking number provided. 

    Most retailers also offer support through their customer service team who can investigate the issue, 
    file a claim with the shipping company, or arrange for a replacement or refund if necessary.`,
        
        'return': `To return a product bought online, start by checking the retailer's return policy on their website 
    to understand the timeframe and conditions. 

    Log into your account, find the order, and select the return option. 
    Print the return label if provided, pack the item securely in its original packaging, 
    and ship it back using the prepaid label or your own shipping method. 

    Once the return is received and processed, you'll typically get a refund or exchange within a few business days.`,
        
        'billing': `For billing issues with your subscription, first review your account settings and payment history 
    on the service's website or app. 

    If you notice an error, contact customer support through their help center, chat, or phone line. 

    Provide details like your account information, the charge in question, and any supporting documents. 
    Most companies can resolve billing disputes quickly and may issue refunds or credits if an error occurred.`
      };

      const lowerQuestion = question.toLowerCase();
      
      if (lowerQuestion.includes('track') || lowerQuestion.includes('amazon')) {
        return responses.track;
      } else if (lowerQuestion.includes('package') || lowerQuestion.includes('arrived')) {
        return responses.package;
      } else if (lowerQuestion.includes('return')) {
        return responses.return;
      } else if (lowerQuestion.includes('billing') || lowerQuestion.includes('subscription')) {
        return responses.billing;
      }
      
      return `Thank you for your question. Our customer service team is here to help you with any inquiries. 
    Please provide more details about your issue, and we'll guide you through the best solution.`;
    }

    function showRatingBlock() {
      ratingBlock.classList.remove('hidden');
      modalOverlay.classList.remove('hidden');
      document.body.classList.add('overflow-hidden');
    }

    function hideRatingBlock() {
      ratingBlock.classList.add('hidden');
      modalOverlay.classList.add('hidden');
      document.body.classList.remove('overflow-hidden');
      document.getElementById('commentInput').value = '';
      currentRating = 0;
      updateStars();
    }

    document.getElementById('starRating').addEventListener('click', function(e) {
      if (e.target.classList.contains('star')) {
        currentRating = parseInt(e.target.dataset.rating);
        updateStars();
      }
    });

    function updateStars() {
      const stars = document.querySelectorAll('.star');
      stars.forEach((star, index) => {
        if (index < currentRating) {
          star.classList.add('active');
        } else {
          star.classList.remove('active');
        }
      });
    }

    closeRatingModal.addEventListener('click', hideRatingBlock);
    modalOverlay.addEventListener('click', hideRatingBlock);

    document.getElementById('submitFeedback').addEventListener('click', function() {
      const comment = document.getElementById('commentInput').value.trim();
      
      if (!comment) {
        alert('Please leave a review');
        return;
      }

      if (currentRating === 0) {
        alert('Please provide a rating');
        return;
      }

      const isValid = Math.random() > 0.3; 
      showValidationResult(isValid);
      hideRatingBlock();
    });

    function showValidationResult(isValid) {
      const resultDiv = document.createElement('div');
      resultDiv.className = 'chat-message flex justify-start mt-2';
      
      if (isValid) {
        resultDiv.innerHTML = `
          <div class="max-w-full px-4 py-2 rounded-lg bg-white border border-gray-300 flex items-center gap-2 text-green-700">
            <span class="font-medium">Accepted (validation passed)</span>
          </div>
        `;
      } else {
        const reasons = [
          'Feedback contains inappropriate language',
          'Review is too short',
          'Spam content detected',
          'More detailed feedback is required'
        ];
        const reason = reasons[Math.floor(Math.random() * reasons.length)];
        
        resultDiv.innerHTML = `
          <div class="max-w-full px-4 py-2 rounded-lg bg-white border border-gray-300 text-red-700">
            <div class="font-medium mb-1">Rejected (validation failed)</div>
            <div class="text-sm">${reason}</div>
          </div>
        `;
      }

      chatMessages.appendChild(resultDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;

      setTimeout(() => {
        resultDiv.remove();
      }, 3000);
    }

    function startNewChat() {
      chatMessages.innerHTML = '';
      chatMessages.classList.add('hidden');
      welcomeScreen.classList.remove('hidden');
      questionBlock.classList.add('hidden');
      messageInput.value = '';
      chatInput.value = '';
      document.getElementById('commentInput').value = '';
      currentRating = 0;
      updateStars();
      closeSidebar();
    }

    openSidebarBtn.addEventListener('click', openSidebar);
    closeSidebarBtn.addEventListener('click', closeSidebar);
    newChatBtn.addEventListener('click', startNewChat);

    window.fillQuestion = fillQuestion;
  </script>
</body>
</html>
